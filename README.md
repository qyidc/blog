# è®°å¿†ç¢ç‰‡

ä¸€ä¸ªåŸºäº Cloudflare Workers å’Œ D1 æ•°æ®åº“æ„å»ºçš„ç°ä»£åŒ–åšå®¢ç³»ç»Ÿï¼Œæ”¯æŒé™æ€é¡µé¢ç¼“å­˜ã€è¯„è®ºç³»ç»Ÿã€ä»£ç é«˜äº®ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ“ **æ–‡ç« ç®¡ç†**ï¼šæ”¯æŒæ–‡ç« å‘å¸ƒã€ç¼–è¾‘ã€è‰ç¨¿ã€ç½®é¡¶
- ğŸ·ï¸ **åˆ†ç±»ä¸æ ‡ç­¾**ï¼šçµæ´»çš„å†…å®¹åˆ†ç±»å’Œæ ‡ç­¾ç³»ç»Ÿ
- ğŸ’¬ **è¯„è®ºç³»ç»Ÿ**ï¼šæ”¯æŒæ¥¼ä¸­æ¥¼åµŒå¥—å›å¤ã€@ç”¨æˆ·æé†’
- ğŸ¨ **ä»£ç é«˜äº®**ï¼šé»‘åº•ç»¿å­—é£æ ¼ï¼Œæ˜¾ç¤ºä»£ç è¯­è¨€ï¼Œä¸€é”®å¤åˆ¶
- ğŸ“Š **æ•°æ®åˆ†æ**ï¼šåå°ç»Ÿè®¡é¢æ¿ï¼Œå±•ç¤ºæ–‡ç« ã€è¯„è®ºã€é˜…è¯»é‡ç­‰æ•°æ®
- ğŸ” **æœç´¢åŠŸèƒ½**ï¼šå…¨ç«™æ–‡ç« æœç´¢
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šå®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

### æŠ€æœ¯ç‰¹æ€§
- âš¡ **é«˜æ€§èƒ½**ï¼šåŸºäº Cloudflare Workers è¾¹ç¼˜è®¡ç®—
- ğŸ’¾ **D1 æ•°æ®åº“**ï¼šCloudflare åŸç”Ÿ SQLite æ•°æ®åº“
- ğŸ—„ï¸ **R2 å­˜å‚¨**ï¼šé™æ€é¡µé¢å’Œèµ„æºæ–‡ä»¶å­˜å‚¨
- ğŸ”„ **é™æ€ç¼“å­˜**ï¼šè‡ªåŠ¨ç”Ÿæˆé™æ€é¡µé¢ï¼Œæå‡è®¿é—®é€Ÿåº¦
- ğŸŒ **CDN åŠ é€Ÿ**ï¼šå…¨çƒ CDN åˆ†å‘ï¼Œè®¿é—®é€Ÿåº¦æå¿«
- ğŸ”’ **HTTPS**ï¼šè‡ªåŠ¨ SSL è¯ä¹¦

## æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**ï¼šCloudflare Workers
- **æ•°æ®åº“**ï¼šCloudflare D1 (SQLite)
- **å­˜å‚¨**ï¼šCloudflare R2
- **å‰ç«¯**ï¼šåŸç”Ÿ HTML/CSS/JavaScript
- **æ ·å¼**ï¼šTailwind CSS
- **ä»£ç é«˜äº®**ï¼šhighlight.js

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

1. æ³¨å†Œ [Cloudflare](https://dash.cloudflare.com/) è´¦å·
2. å®‰è£… Node.js (v16 æˆ–æ›´é«˜ç‰ˆæœ¬)
3. å®‰è£… Wrangler CLIï¼š

```bash
npm install -g wrangler
```

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**

```bash
git clone https://github.com/qyidc/blog.git
cd blog
```

2. **å®‰è£…ä¾èµ–**

```bash
npm install
```

3. **é…ç½® Wrangler**

ç™»å½• Cloudflareï¼š

```bash
wrangler login
```

4. **åˆ›å»º D1 æ•°æ®åº“**

```bash
wrangler d1 create cf_blog-db
```

è®°å½•è¾“å‡ºçš„ `database_id`ï¼Œç„¶åå¤åˆ¶ `wrangler.jsonc.example` ä¸º `wrangler.jsonc` å¹¶å¡«å…¥ä½ çš„æ•°æ®åº“ IDï¼š

```bash
cp wrangler.jsonc.example wrangler.jsonc
```

ç¼–è¾‘ `wrangler.jsonc`ï¼Œå°† `YOUR_DATABASE_ID_HERE` æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®åº“ IDã€‚

5. **åˆ›å»º R2 å­˜å‚¨æ¡¶**

```bash
wrangler r2 bucket create cfblog-pages
wrangler r2 bucket create cfblog-assets
```

6. **æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–**

```bash
wrangler d1 execute cf_blog-db --file=./migrations/init.sql
```

7. **æ„å»ºæ ·å¼**

```bash
npm run build:css
```

8. **éƒ¨ç½²**

```bash
npm run deploy
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `wrangler.jsonc` ä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼š

```json
{
  "vars": {
    "BLOG_TITLE": "è®°å¿†ç¢ç‰‡",
    "BLOG_SUBTITLE": "è®°å½•ç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´"
  }
}
```

### åå°ç®¡ç†

è®¿é—® `/admin` è¿›å…¥åå°ç®¡ç†é¡µé¢ï¼Œå¯ä»¥ï¼š
- å‘å¸ƒå’Œç®¡ç†æ–‡ç« 
- æŸ¥çœ‹ç»Ÿè®¡æ•°æ®
- ç®¡ç†è¯„è®º
- ä¸Šä¼ å›¾ç‰‡

## æœ¬åœ°å¼€å‘

å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼š

```bash
npm run dev
```

è®¿é—® `http://localhost:8787` æŸ¥çœ‹åšå®¢ã€‚

## é¡¹ç›®ç»“æ„

```
blog/
â”œâ”€â”€ migrations/          # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ public/            # é™æ€èµ„æº
â”‚   â”œâ”€â”€ admin/         # åå°ç®¡ç†é¡µé¢
â”‚   â””â”€â”€ assets/       # CSSã€å›¾ç‰‡ç­‰èµ„æº
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts      # ä¸»åº”ç”¨ä»£ç 
â”œâ”€â”€ styles/           # Tailwind CSS æºæ–‡ä»¶
â”œâ”€â”€ wrangler.jsonc     # Cloudflare Workers é…ç½®
â””â”€â”€ package.json      # é¡¹ç›®ä¾èµ–
```

## æ•°æ®åº“è¡¨ç»“æ„

### articles
- æ–‡ç« è¡¨ï¼Œå­˜å‚¨åšå®¢æ–‡ç« å†…å®¹

### images
- å›¾ç‰‡è¡¨ï¼Œå­˜å‚¨ä¸Šä¼ çš„å›¾ç‰‡ä¿¡æ¯

### comments
- è¯„è®ºè¡¨ï¼Œæ”¯æŒåµŒå¥—å›å¤

### views
- é˜…è¯»é‡ç»Ÿè®¡è¡¨

### blacklist
- é»‘åå•è¡¨ï¼Œç”¨äºå±è”½æ¶æ„ç”¨æˆ·

## API æ¥å£

### æ–‡ç« ç›¸å…³
- `GET /` - é¦–é¡µ
- `GET /blog/:slug` - æ–‡ç« è¯¦æƒ…
- `GET /category/:category` - åˆ†ç±»æ–‡ç« 
- `GET /tags/:tag` - æ ‡ç­¾æ–‡ç« 
- `GET /archive` - å½’æ¡£é¡µé¢
- `GET /search` - æœç´¢æ–‡ç« 

### ç®¡ç†æ¥å£
- `POST /api/admin/login` - åå°ç™»å½•
- `POST /api/admin/posts` - åˆ›å»ºæ–‡ç« 
- `PUT /api/admin/posts/:id` - æ›´æ–°æ–‡ç« 
- `DELETE /api/admin/posts/:id` - åˆ é™¤æ–‡ç« 
- `GET /api/statistics` - è·å–ç»Ÿè®¡æ•°æ®

### è¯„è®ºæ¥å£
- `POST /api/comments` - æäº¤è¯„è®º
- `GET /api/comments/:slug` - è·å–æ–‡ç« è¯„è®º

## å¸¸è§é—®é¢˜

### å¦‚ä½•æ›´æ–°åšå®¢æ ‡é¢˜ï¼Ÿ

ä¿®æ”¹ `wrangler.jsonc` ä¸­çš„ `BLOG_TITLE` ç¯å¢ƒå˜é‡ï¼Œç„¶åé‡æ–°éƒ¨ç½²ã€‚

### å¦‚ä½•è‡ªå®šä¹‰æ ·å¼ï¼Ÿ

ç¼–è¾‘ `styles/input.css` æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ `npm run build:css` é‡æ–°æ„å»ºæ ·å¼ã€‚

### å¦‚ä½•æ·»åŠ æ–°çš„è¿ç§»æ–‡ä»¶ï¼Ÿ

åœ¨ `migrations/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ SQL æ–‡ä»¶ï¼Œå‘½åæ ¼å¼ä¸º `0006_xxx.sql`ï¼Œç„¶åæ‰§è¡Œï¼š

```bash
wrangler d1 execute cf_blog-db --file=./migrations/0006_xxx.sql
```

### é™æ€é¡µé¢å¦‚ä½•æ›´æ–°ï¼Ÿ

è®¿é—®æ–‡ç« é¡µé¢æ—¶ä¼šè‡ªåŠ¨æ›´æ–°é™æ€ç¼“å­˜ã€‚å¦‚éœ€æ‰‹åŠ¨æ›´æ–°ï¼Œå¯ä»¥åˆ é™¤ R2 å­˜å‚¨æ¡¶ä¸­çš„å¯¹åº”æ–‡ä»¶ã€‚

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è”ç³»æ–¹å¼

- GitHub: [qyidc](https://github.com/qyidc)
- åšå®¢: [è®°å¿†ç¢ç‰‡](https://blog.otwx.top)
